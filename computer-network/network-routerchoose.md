# 计算机网络路由协议

[toc]

想必我们大家都鼓捣过路由器，路由器可以说是我们日常生活中必不可少的一个装备了，就算你不是程序员，想必你隔壁的七大姑八大姨估计也让你配置过路由器。但是大家有没有想过一个问题，这个路由器是干啥用的？你可能知道这是为终端设备提供 WI-FI 连接上网的一种设备，当我们终端设备连接 WI-FI 后，就可以通过路由器把数据从我的设备传到我想要的地方（其他终端设备），然后实现我想要的东西和内容。

这个回答整体上是能说通的，但是这里我就要问你一个问题了。

>路由器是如何把数据发送给其他路由器的呢？

这个问题要回答上来，就要从路由协议来说起了。

在互联网中，不管是局域网还是广域网，一个数据包是可以通过合理的路由控制从一个终端传输到另一个终端的。而起到控制这个数据包发送过程就是路由控制模块，路由控制模块遵循路由协议，路由协议是整个互联网的数据路由的规范和标准。

## 路由

为了能够让数据包正确的到达目标主机，路由器必须要在数据发送的过程中进行正确的转发，这也是路由器的第一个作用：**数据处理**，除了能够转发外，数据处理还包括对数据进行分组过滤、加密、压缩等。

>那么路由器是怎么知道这个数据是要发往哪里的呢？

路由器内部维护了一个路由表，这个路由表会记录数据包中目标主机的 IP 地址和输出路径。**路由器的主要工作就是为每个经过路由的数据包寻找一个最佳的传输路径**，关于路由器的一些结构和转发规则我们已经在 [路由器你竟然是这样的...](https://mp.weixin.qq.com/s?__biz=MzI0ODk2NDIyMQ==&mid=2247487351&idx=1&sn=9aa613589f85ce4c0c4142274e2a287d&chksm=e999fa65deee73732f97267db0e58d28925f4c57f7850d1e3b4633275385ac844e204fd03f03&token=2132126432&lang=zh_CN#rd) 这篇文章中提到过了。

### 静态路由和动态路由

我们通常会把路由器分为静态路由和动态路由两种，不管是静态路由还是动态路由，都不会脱离路由表。如果数据发送前你已经把路由规则设置好，在发送时数据会按照你事先设置好的路径进行转发的话，这就是静态路由，如果你事先没有设置路由规则，只是让数据在发送的过程中按照**路由协议**的既定规则进行转发的话，这就是动态路由，这两种路由方式各有利弊。

静态路由会让你做大量且重复的设置路由的工作，效率低而且任务量很大，并且扩展性比较差，一旦新增一个路由，就会让你把所有的路由重新设置一遍，甚至还有单点问题，当传输节点中某一个路由出现故障时，数据基本不会饶过这个路由，需要管理员把路由重新设置才能继续发送。

![image-20210623104309245](/Users/mr.l/Library/Application Support/typora-user-images/image-20210623104309245.png)

使用动态路由也需要手动设置一些东西，只不过需要设置的是路由协议，每个路由协议的复杂程度不同，所以设置的难以程度也不同，比如 RIP 协议的设置过程就比较简单，OSPF 的设置过程就比较繁琐。不过一旦设置完成后，如果要新增加一个路由，就只需要设置新增加的单个路由就可以，而且避免了单点问题，动态路由能够选择其他路径从而绕过故障路由。

![image-20210623105222901](/Users/mr.l/Library/Application Support/typora-user-images/image-20210623105222901.png)

虽然静态路由和动态路由都各有利弊，但是你把他们结合以来一起使用就可以了。成年人全都要。

## 路由协议

上面讨论了动态路由会根据网络情况动态调整数据的转发路径，那么这种行为方式是以什么为基础的呢？

答案是**通过路由之间相互交换路由表来实现的**。路由器之间会在合适的时间交换路由表，通过这种方式，可以让网络之间所有的路由器都能够动态调整数据的转发路径。当网络情况发生变化时，路由器之间彼此交换的路由信息会告知对方网络的这种变化，通过信息扩散使所有路由器都能得知网络变化。

> 常见的动态路由协议有**RIP、OSPF、BGP、MPLS** 等，根据不同的自治系统还可以分为 IGP（内部网关协议） 和 EGP（外部网关协议）。这个内外有啥区别呢？

这就需要先了解一下什么是自治系统：

一个*自治系统（AS）*就是处于一个 ISP 网络服务提供商管理控制下的路由器和网络群组，它可以是一个路由器直接连接到 LAN 上，同时连接到 Internet 上，也可以是由企业骨干网互联的多个局域网。

自治系统内部的动态路由采用的是**域内路由协议 IGP**，而自治系统之间的路由控制采用的是**域间路由协议 EGP**。IGP 和 EGP 又可以叫做内部外观协议和外部网关协议。IGP 和 EGP 是相辅相成的关系，没有 EGP 就不可能实现在不同机构之间的通信，没有 IGP 也就不可能实现自治系统的内部通信。IGP 协议可以细分为 **RIP、RIP 2、OSPF 等众多协议**。EGP 协议使用的是 BGP 协议。

















